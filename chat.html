<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>n8n Chat з параметрами</title>
  <link href="https://cdn.jsdelivr.net/npm/@n8n/chat/dist/style.css" rel="stylesheet" />
  <style>
    html, body { margin: 0; padding: 0; height: 100%; width: 100%; }
  </style>
</head>
<body>
<script type="module">
  import { createChat } from 'https://cdn.jsdelivr.net/npm/@n8n/chat/dist/chat.bundle.es.js';

  // 🔍 Зчитуємо параметри з URL
  const params = new URLSearchParams(window.location.search);

  const ads_login_customer_id = params.get('ads_login_customer_id') || 'unknown-session';
  const ads_customer_id = params.get('ads_customer_id') || 'unknown-customer';
  const account_name = params.get('account_name') || 'anonymous';
  const chatSessionKey = params.get('ads_customer_id') || 'anonymous';
  // 📦 Формуємо metadata
  const metadata = {
    ads_customer_id,
    ads_login_customer_id,
    account_name
  };

  // 💬 Виводимо перше повідомлення
  const initialMessages = [
    `👋 Привіт!`,
    `Це чат для аккаунта ${user}`,
  ];

  // ▶️ Запускаємо чат
  createChat({
    mode: 'fullscreen',
    webhookUrl: 'https://n8n.boni.tools/webhook/65cedb3a-eedf-4ab5-ba41-fd9553e787e6/chat',
    chatSessionKey: chatSessionKey,
    loadPreviousSession: true,
    metadata: metadata,
    initialMessages: initialMessages
  });
</script>
</body>
</html>
